
<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿ™ŸÅÿßÿπŸÑŸäÿ© ÿ™ÿπŸÑŸäŸÖŸäÿ© - ŸÜÿ≥ÿÆÿ© ŸÖÿπŸÑŸÖ ÿßŸÑŸÖŸàÿßÿØ ÿßŸÑÿ£ÿÆÿ±Ÿâ</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;700&display=swap');

* {
    box-sizing: border-box;
    font-family: 'Segoe UI', 'Noto Sans Arabic', Tahoma, Geneva, Verdana, sans-serif;
}

body {
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
    min-height: 100vh;
    margin: 0;
    padding: 20px;
    color: white;
}

.container {
    max-width: 800px;
    margin: 20px auto;
    opacity: 0;
    transform: translateY(20px);
    animation: fadeIn 0.5s ease-out forwards;
}

.header {
    text-align: center;
    margin-bottom: 40px;
    font-size: small;
}

.quiz-box {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 15px;
    padding: 30px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    color: #333;
    position: relative;
}

.question {
    font-size: 1.4em;
    margin-bottom: 25px;
    font-weight: 700;
    line-height: 1.4;
    direction: rtl;
    text-align: right;
}

.options {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    justify-content: center;
    gap: 10px;
}

.options-row {
    display: grid;
    justify-content: center;
    gap: 10px;
}

.options-two {
    grid-template-columns: repeat(2, 1fr);
    max-width: 500px;
    margin: 0 auto;
}

.options-three {
    grid-template-columns: repeat(3, 1fr);
    max-width: 750px;
    margin: 0 auto;
}

@media (max-width: 768px) {
    .container {
        padding: 10px;
    }

    .quiz-box {
        padding: 20px;
    }

    .options {
        grid-template-columns: 1fr;
    }

    .options-row {
        grid-template-columns: 1fr;
    }

    .option {
        padding: 12px 20px;
        min-height: 100px;
        max-height: 120px;
    }

    .question-image,
    .reading-text-image {
        max-height: 80px;
    }

    .counters {
        flex-direction: column;
        align-items: stretch;
    }

    #timer {
        order: 2;
        margin: 10px 0;
    }

    .katex-display {
        font-size: 0.9em;
        overflow-x: scroll;
    }
}

.option {
    background: #f8f9fa;
    padding: 10px;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid transparent;
    width: 100%;
    min-height: 120px;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
}

.option:hover {
    transform: translateX(10px);
    background: #e9ecef;
}

.option.correct {
    background: #28a745 !important;
    color: white !important;
}

.option.wrong {
    background: #dc3545 !important;
    color: white !important;
}

.question-image {
    width: 100%;
    max-height: 80px;
    object-fit: contain;
    margin: 10px auto;
    display: block;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.reading-text-image {
    width: 100%;
    max-height: 80px;
    object-fit: contain;
    margin: 10px auto;
    display: block;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.option-content img {
    width: 100%;
    max-height: 60px;
    object-fit: contain;
    background: #fff;
    border-radius: 5px;
    margin: 0 auto;
    display: block;
}

.controls {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
    margin-top: 20px;
}

.nav-btn {
    background: #007bff;
    color: white;
    border: none;
    padding: 10px 25px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.nav-btn:disabled {
    background: #6c757d;
    cursor: not-allowed;
}

.pause-btn {
    background: #ffc107;
    color: black;
}

.progress-bar {
    height: 8px;
    background: #dee2e6;
    border-radius: 4px;
    margin: 20px 0;
    overflow: hidden;
}

.progress {
    height: 100%;
    background: #4CAF50;
    width: 0;
    transition: width 0.3s ease;
}

.score-board {
    text-align: center;
    font-size: 1.5em;
    display: none;
}

.restart-btn {
    background: #007bff;
    color: white;
    border: none;
    padding: 12px 30px;
    border-radius: 25px;
    cursor: pointer;
    font-size: 1.1em;
    margin: 20px auto;
    display: block;
    transition: transform 0.3s ease;
}

.reading-text {
    background: rgba(255, 255, 255, 0.85);
    color: #1e3c72;
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 20px;
    font-size: 1.2em;
    line-height: 1.7;
    font-weight: 500;
    direction: rtl;
    text-align: right;
}

.config-btn {
    position: fixed;
    top: 20px;
    left: 20px;
    background: white;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    cursor: pointer;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
}

@keyframes fadeIn {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.counters {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: -15px 0 25px 0;
    padding: 15px;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 10px;
    font-weight: 500;
    color: #2a5298;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    font-size: 1.1em;
    gap: 10px;
}

#timer {
    flex: 1;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    background: rgba(255, 255, 255, 0.9);
    padding: 8px 20px;
    border-radius: 30px;
    font-weight: 700;
}

#questionCounter::before {
    content: "üìå ";
    margin-left: 5px;
}

#scoreCounter::before {
    content: "üèÜ ";
    margin-left: 5px;
}

#timer::before {
    content: "‚è≥";
    font-size: 1.3em;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

#scoreBoard h2 {
    direction: ltr;
    display: inline-block;
}

.question-content {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 20px;
}

.question-content img {
    width: 100%;
    max-height: 80px;
    object-fit: contain;
    border-radius: 8px;
    margin: 10px 0;
}

.option-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    width: 100%;
}

.option-text {
    text-align: center;
    padding: 5px;
    width: 100%;
    font-size: 18px;
    font-weight: bold;
    color: #333;
}

.math-container {
    display: inline-block;
    margin: 5px 0;
    padding: 5px;
    background-color: rgba(255, 255, 255, 0.8);
    border-radius: 5px;
}

.katex-display {
    margin: 0.5em 0;
    overflow-x: auto;
    overflow-y: hidden;
    padding: 5px;
}

.option .katex {
    font-size: 2em;
}

.option .katex-display {
    margin: 0;
}

.question .katex {
    font-size: 1.3em;
}

.action-btn {
    background: #007bff;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    margin: 10px 5px;
    display: inline-block;
    font-size: 1em;
}

.action-btn:hover {
    background: #0056b3;
    transform: translateY(-2px);
}

.action-btn.sample {
    background: #28a745;
}

.action-btn.sample:hover {
    background: #218838;
}

.action-btn.settings-btn {
    background: #6c757d;header
}

.buttons-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    margin: 15px 0;
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
}

@media (min-width: 768px) {
    .buttons-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        grid-gap: 10px;
    }
}

.settings-panel {
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 20px;
    color: #333;
    border: 1px solid #ccc;
    margin-top: 15px;
    max-width: 600px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    display: none;
}

.settings-title {
    font-weight: bold;
    margin-bottom: 15px;
    font-size: 18px;
}

.settings-option {
    margin-bottom: 10px;
}

.settings-option label {
    display: block;
    margin-bottom: 5px;
    font-weight: 500;
}

.settings-option select,
.settings-option input {
    width: 100%;
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #ddd;
}

.config-panel {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
    display: none;
    color: #333;
    z-index: 9999;
    width: 90%;
    max-width: 500px;
}

.config-panel h3 {
    margin-bottom: 20px;
}

.form-control {
    width: 98%;
    max-width: 1000px;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    resize: vertical;
    box-sizing: border-box;
}

.form-group {
    margin-top: 15px;
}

.config-buttons {
    margin-top: 20px;
    text-align: left;
}

footer {
    position: relative;
    bottom: 0;
    width: 100%;
    text-align: center;
    padding: 10px;
    background: #f1f1f1;
    color: #333;
    font-family: 'Tajawal', Arial, sans-serif;
    direction: rtl;
}

.display-box {
    background-color: #f9f9f9;
    padding: 12px;
    margin: 10px 0;
    border-radius: 8px;
    font-size: 18px;
    line-height: 1.7;
}
</style>

</head>
<body>
    <button class="config-btn" onclick="toggleConfigPanel()">‚öôÔ∏è</button>
    <div class="container">
        <div class="header">
            <h1 id="quizTitle">ŸÉŸàŸäÿ≤ ÿßŸÑÿ´ŸÇÿßŸÅÿ© ÿßŸÑÿπÿßŸÖÿ© üá∏üá¶</h1>
            <p id="instructions">ÿßÿÆÿ™ÿ± ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿßŸÑÿµÿ≠Ÿäÿ≠ÿ© ŸÑŸÉŸÑ ÿ≥ÿ§ÿßŸÑ ŸÇÿ®ŸÑ ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑŸàŸÇÿ™</p>
        </div>
<div class="buttons-container">
    <button class="action-btn" id="loadButton" onclick="loadQuestionsFromFile()">ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©</button>
    <button class="action-btn settings-btn" id="settingsBtn" onclick="toggleSettingsPanel()">ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿπÿ±ÿ∂</button>
    <button class="action-btn" id="editButton" onclick="toggleEditMode()">ÿ™ÿ≠ÿ±Ÿäÿ± ÿßŸÑÿ≥ÿ§ÿßŸÑ</button>
</div>
<div class="settings-panel" id="editPanel" style="display: none;">
    <div class="settings-title">ÿ™ÿ≠ÿ±Ÿäÿ± ÿßŸÑÿ≥ÿ§ÿßŸÑ</div>
    <div class="settings-option">
        <label for="editReadingText">ÿßŸÑŸÜÿµ ÿßŸÑŸÇÿ±ÿßÿ¶Ÿä:</label>
        <textarea id="editReadingText" class="form-control" rows="5"></textarea>
        <label for="editReadingImage">ÿµŸàÿ±ÿ© ÿßŸÑŸÜÿµ ÿßŸÑŸÇÿ±ÿßÿ¶Ÿä:</label>
        <input type="file" id="editReadingImage" accept="image/*" />
        <img id="readingImagePreview" style="display: none; max-width: 100%; max-height: 150px; margin: 10px 0;" />
    </div>
    <div class="settings-option">
        <label for="editQuestionText">ÿßŸÑÿ≥ÿ§ÿßŸÑ:</label>
        <input type="text" id="editQuestionText" class="form-control" />
        <label for="editQuestionImage">ÿµŸàÿ±ÿ© ÿßŸÑÿ≥ÿ§ÿßŸÑ:</label>
        <input type="file" id="editQuestionImage" accept="image/*" />
        <img id="questionImagePreview" style="display: none; max-width: 100%; max-height: 150px; margin: 10px 0;" />
    </div>
    <div class="settings-option">
        <label>ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™:</label>
        <div style="display: grid; gap: 10px;">
            <div>
                <input type="checkbox" id="correct1" />
                <label for="editOption1">ÿÆŸäÿßÿ± 1:</label>
                <input type="text" id="editOption1" class="form-control" />
                <input type="file" id="editOptionImage1" accept="image/*" />
                <img id="optionImagePreview1" style="display: none; max-width: 100%; max-height: 100px; margin: 10px 0;" />
            </div>
            <div>
                <input type="checkbox" id="correct2" />
                <label for="editOption2">ÿÆŸäÿßÿ± 2:</label>
                <input type="text" id="editOption2" class="form-control" />
                <input type="file" id="editOptionImage2" accept="image/*" />
                <img id="optionImagePreview2" style="display: none; max-width: 100%; max-height: 100px; margin: 10px 0;" />
            </div>
            <div>
                <input type="checkbox" id="correct3" />
                <label for="editOption3">ÿÆŸäÿßÿ± 3:</label>
                <input type="text" id="editOption3" class="form-control" />
                <input type="file" id="editOptionImage3" accept="image/*" />
                <img id="optionImagePreview3" style="display: none; max-width: 100%; max-height: 100px; margin: 10px 0;" />
            </div>
            <div>
                <input type="checkbox" id="correct4" />
                <label for="editOption4">ÿÆŸäÿßÿ± 4:</label>
                <input type="text" id="editOption4" class="form-control" />
                <input type="file" id="editOptionImage4" accept="image/*" />
                <img id="optionImagePreview4" style="display: none; max-width: 100%; max-height: 100px; margin: 10px 0;" />
            </div>
        </div>
    </div>
    <div class="settings-footer" style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
        <button class="nav-btn" onclick="saveEdit()" style="background: #28a745;">ÿ≠ŸÅÿ∏</button>
        <button class="nav-btn" onclick="addNewQuestion()" style="background: #007bff;">ÿ•ÿ∂ÿßŸÅÿ© ÿ≥ÿ§ÿßŸÑ</button>
        <button class="nav-btn" onclick="deleteCurrentQuestion()" style="background: #dc3545;">ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ§ÿßŸÑ</button>
        <button class="nav-btn" onclick="cancelEdit()">ÿ•ŸÑÿ∫ÿßÿ°</button>
    </div>
</div>
        <div class="settings-panel" id="settingsPanel">
            <div class="settings-title">ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿπÿ±ÿ∂</div>
            <div class="settings-option">
                <label for="numeralType">ŸÜŸàÿπ ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ:</label>
                <select id="numeralType" onchange="changeNumeralType()">
                    <option value="arabic">ÿ£ÿ±ŸÇÿßŸÖ ÿπÿ±ÿ®Ÿäÿ© (1, 2, 3)</option>
                    <option selected value="eastern">ÿ£ÿ±ŸÇÿßŸÖ ŸáŸÜÿØŸäÿ© ÿ¥ÿ±ŸÇ ÿ£Ÿàÿ≥ÿ∑Ÿäÿ© (Ÿ°, Ÿ¢, Ÿ£)</option>
                </select>
            </div>
            <div class="settings-option">
                <button onclick="cleanEasternNumerals()" style="margin-top: 8px; background-color:#dc3545; color:white; padding: 5px 10px; border:none; border-radius:5px; cursor:pointer;">
                    üßπ ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ ÿßŸÑŸáŸÜÿØŸäÿ© ÿØÿßÿÆŸÑ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©
                </button>
            </div>
            <div class="settings-option">
                <label for="questionTime">ŸàŸÇÿ™ ÿßŸÑÿ≥ÿ§ÿßŸÑ (ÿ®ÿßŸÑÿ´ŸàÿßŸÜŸä):</label>
                <input id="questionTime" max="120" min="5" onchange="changeQuestionTime()" type="number" value="30" />
            </div>
            <div class="settings-footer">
                <button class="nav-btn" onclick="toggleSettingsPanel()">ÿ≠ŸÅÿ∏ Ÿàÿ•ÿ∫ŸÑÿßŸÇ</button>
            </div>
        </div>
        <div class="counters" id="countersBox">
            <div id="questionCounter">üìå ÿßŸÑÿ≥ÿ§ÿßŸÑ Ÿ† ŸÖŸÜ Ÿ†</div>
            <div id="timer">‚è≥ ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÖÿ™ÿ®ŸÇŸä: Ÿ† ÿ´ÿßŸÜŸäÿ©</div>
            <div id="scoreCounter">üèÜ ÿßŸÑÿØÿ±ÿ¨ÿßÿ™: Ÿ† ŸÖŸÜ Ÿ†</div>
        </div>
        <div class="reading-text" id="readingText"></div>
        <div class="quiz-box">
            <div class="question" id="question"></div>
            <div class="options" id="options"></div>
            <div class="controls">
                <button class="nav-btn" disabled id="prevBtn" onclick="previousQuestion()">ÿßŸÑÿ≥ÿßÿ®ŸÇ</button>
                <button class="nav-btn pause-btn" id="pauseBtn" onclick="togglePause()">ÿ™ŸàŸÇŸÅ</button>
                <button class="nav-btn" disabled id="nextBtn" onclick="nextQuestion()">ÿßŸÑÿ™ÿßŸÑŸä</button>
            </div>
            <div class="progress-bar">
                <div class="progress" id="progress"></div>
            </div>
        </div>
    </div>
    <div class="score-board" id="scoreBoard">
        <h2>ŸÜÿ™Ÿäÿ¨ÿ™ŸÉ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©: <span id="totalQuestions">Ÿ†</span>/<span id="finalScore">Ÿ†</span></h2>
        <button class="restart-btn" onclick="restartQuiz()">ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ©</button>
    </div>
    <div class="config-panel" id="configPanel">
        <h3>ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ</h3>
        <label for="titleInput">ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÉŸàŸäÿ≤:</label>
        <input class="form-control" id="titleInput" type="text" />
        <label for="instructionsInput" class="form-group">ÿßŸÑÿ™Ÿàÿ¨ŸäŸáÿßÿ™:</label>
        <textarea class="form-control" id="instructionsInput" rows="5"></textarea>
        <div class="form-group">
            <label for="footerInput">ÿßŸÑÿ™ÿ∞ŸäŸäŸÑ:</label>
            <textarea class="form-control" id="footerInput" rows="3">
ÿ•ÿπÿØÿßÿØ Ÿàÿ™ÿµŸÖŸäŸÖ / ŸÖŸÑÿ™ŸÇŸâ ŸÖÿπŸÑŸÖŸä ŸàŸÖÿπŸÑŸÖÿßÿ™ ÿßŸÑŸÖŸàÿßÿØ ÿßŸÑÿ£ÿÆÿ±Ÿâ ŸÄ ÿßŸÑŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ÿßŸÑÿ≥ÿπŸàÿØŸäÿ©
            </textarea>
        </div>
        <div class="config-buttons">
            <button class="nav-btn" onclick="saveConfig()">ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™</button>
            <button class="nav-btn" onclick="toggleConfigPanel()">ÿ•ŸÑÿ∫ÿßÿ°</button>
        </div>
    </div>
    <script>
        const state = {
            questions: [],
            currentQuestion: 0,
            score: 0,
            timeLeft: 30,
            questionTime: 30,
            timerId: null,
            isPaused: false,
            answeredQuestions: [],
            numeralType: 'eastern'
        };
        const quizConfig = {
            title: 'ŸÉŸàŸäÿ≤ ÿßŸÑÿ´ŸÇÿßŸÅÿ© ÿßŸÑÿπÿßŸÖÿ© üá∏üá¶',
            instructions: 'ÿßÿÆÿ™ÿ± ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿßŸÑÿµÿ≠Ÿäÿ≠ÿ© ŸÑŸÉŸÑ ÿ≥ÿ§ÿßŸÑ ŸÇÿ®ŸÑ ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑŸàŸÇÿ™'
        };
        function init() {
            if (state.questions.length === 0) {
                document.getElementById('questionCounter').textContent = `ÿßŸÑÿ≥ÿ§ÿßŸÑ ${convertToSelectedNumerals(0)} ŸÖŸÜ ${convertToSelectedNumerals(0)}`;
                document.getElementById('timer').textContent = `ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÖÿ™ÿ®ŸÇŸä: ${convertToSelectedNumerals(state.timeLeft)} ÿ´ÿßŸÜŸäÿ©`;
                document.getElementById('scoreCounter').textContent = `ÿßŸÑÿØÿ±ÿ¨ÿßÿ™: ${convertToSelectedNumerals(0)} ŸÖŸÜ ${convertToSelectedNumerals(0)}`;
                return;
            }
            state.currentQuestion = 0;
            state.score = 0;
            state.timeLeft = state.questionTime;
            state.answeredQuestions = new Array(state.questions.length).fill(false);
            showQuestion();
        }
        function showQuestion() {
            clearInterval(state.timerId);
            state.timeLeft = state.questionTime;
            const questionElement = document.getElementById('question');
            const optionsElement = document.getElementById('options');
            const readingTextElement = document.getElementById('readingText');
            if (state.currentQuestion >= state.questions.length) {
                showResult();
                return;
            }
            const questionObj = state.questions[state.currentQuestion];
            readingTextElement.innerHTML = '';
            let readingTextContent = '';
            let readingImageSrc = null;
            if (questionObj.reading) {
                readingTextContent = questionObj.reading.text || '';
                readingImageSrc = questionObj.reading.image || null;
            }
            if (!readingTextContent && questionObj.readingText) {
                if (typeof questionObj.readingText === "string") {
                    readingTextContent = questionObj.readingText;
                } else if (typeof questionObj.readingText === "object") {
                    readingTextContent = questionObj.readingText.text || '';
                    readingImageSrc = questionObj.readingText.image || null;
                }
            }
            if (!readingTextContent && questionObj.paragraph) {
                readingTextContent = questionObj.paragraph;
            }
            if (!readingImageSrc && questionObj.paragraphImage) {
                readingImageSrc = questionObj.paragraphImage;
            }
            if (readingTextContent || readingImageSrc) {
                readingTextElement.style.display = 'block';
                if (readingTextContent) {
                    const textElement = document.createElement('div');
                    textElement.className = 'reading-text-content';
                    textElement.innerHTML = convertTextNumerals(readingTextContent).replaceAll('//', '<br>');
                    readingTextElement.appendChild(textElement);
                }
                if (readingImageSrc) {
                    const imgElement = document.createElement('img');
                    imgElement.src = readingImageSrc;
                    imgElement.className = 'reading-text-image';
                    imgElement.alt = 'ÿµŸàÿ±ÿ© ÿßŸÑŸÜÿµ ÿßŸÑŸÇÿ±ÿßÿ¶Ÿä';
                    readingTextElement.appendChild(imgElement);
                }
            } else {
                readingTextElement.style.display = 'none';
            }
            questionElement.innerHTML = '';
            const questionContent = document.createElement('div');
            questionContent.className = 'question-content';
            if (questionObj.question.text) {
                const textElement = document.createElement('div');
                textElement.className = 'question-text';
                textElement.innerHTML = convertTextNumerals(questionObj.question.text).replaceAll('//', '<br>');
                questionContent.appendChild(textElement);
            }
            if (questionObj.question.image) {
                const imgElement = document.createElement('img');
                imgElement.src = questionObj.question.image;
                imgElement.className = 'question-image';
                questionContent.appendChild(imgElement);
            }
            questionElement.appendChild(questionContent);
            optionsElement.innerHTML = '';
            if (!questionObj.options || questionObj.options.length === 0) {
                console.error("ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿÆŸäÿßÿ±ÿßÿ™ ŸÖÿ™ÿßÿ≠ÿ© ŸÑŸáÿ∞ÿß ÿßŸÑÿ≥ÿ§ÿßŸÑ!");
                return;
            }
            const validOptions = [];
            const optionIndices = [];
            questionObj.options.forEach((option, index) => {
                if (!option || (!option.text && !option.image)) return;
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.dataset.originalIndex = index;
                const optionContent = document.createElement('div');
                optionContent.className = 'option-content';
                if (option.image) {
                    const img = document.createElement('img');
                    img.src = option.image;
                    img.className = 'option-image';
                    optionContent.appendChild(img);
                }
                if (option.text) {
                    const text = document.createElement('span');
                    text.className = 'option-text';
                    text.innerHTML = convertTextNumerals(option.text).replaceAll('//', '<br>');
                    optionContent.appendChild(text);
                }
                optionElement.appendChild(optionContent);
                validOptions.push(optionElement);
                optionIndices.push(index);
            });
            optionsElement.classList.remove('options-row', 'options-two', 'options-three');
              if (validOptions.length <= 3) {
              optionsElement.classList.add('options-row');
              if (validOptions.length === 2) {
              optionsElement.classList.add('options-two');
              } else if (validOptions.length === 3) {
              optionsElement.classList.add('options-three');
    }
            }
            validOptions.forEach((optionElement, i) => {
                const originalIndex = optionIndices[i];
                if (state.answeredQuestions[state.currentQuestion]) {
                    optionElement.style.pointerEvents = 'none';
                    if (originalIndex === questionObj.correct) {
                        optionElement.classList.add('correct');
                    }
                }
                optionElement.onclick = () => checkAnswer(originalIndex);
                optionsElement.appendChild(optionElement);
            });
            document.getElementById('prevBtn').disabled = state.currentQuestion === 0;
            document.getElementById('nextBtn').disabled = false;
            document.getElementById('progress').style.width = `${(state.currentQuestion / state.questions.length) * 100}%`;
            updateQuestionCounter();
            updateScoreCounter();
            startTimer();
        }
        
        function startTimer() {
            state.timerId = setInterval(() => {
                if (!state.isPaused) {
                    state.timeLeft--;
                    updateTimerDisplay();
                    if (state.timeLeft <= 0) {
                        clearInterval(state.timerId);
                        nextQuestion();
                    }
                }
            }, 1000);
        }
        function updateTimerDisplay() {
            document.getElementById('timer').textContent = `ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÖÿ™ÿ®ŸÇŸä: ${convertToSelectedNumerals(state.timeLeft)} ÿ´ÿßŸÜŸäÿ©`;
        }
        function checkAnswer(selectedIndex) {
            const options = document.querySelectorAll('.option');
            const correctIndex = state.questions[state.currentQuestion].correct;
            if (state.answeredQuestions[state.currentQuestion]) return;
            options.forEach(option => option.style.pointerEvents = 'none');
            options[correctIndex].classList.add('correct');
            if (selectedIndex === correctIndex) {
                state.score++;
                state.answeredQuestions[state.currentQuestion] = true;
                updateScoreCounter();
            } else {
                options[selectedIndex].classList.add('wrong');
            }
            if (state.currentQuestion < state.questions.length - 1) {
                setTimeout(nextQuestion, 1500);
            } else {
                setTimeout(showResult, 1500);
            }
        }
        function nextQuestion() {
            if (state.currentQuestion >= state.questions.length - 1) {
                showResult();
                return;
            }
            state.currentQuestion++;
            showQuestion();
        }
        function previousQuestion() {
            if (state.currentQuestion > 0) {
                state.currentQuestion--;
                showQuestion();
            }
        }
        function showResult() {
            clearInterval(state.timerId);
            document.querySelector('.quiz-box').style.display = 'none';
            document.getElementById('scoreBoard').style.display = 'block';
            document.querySelector('.buttons-container').style.display = 'none';
            document.getElementById('readingText').style.display = 'none';
            document.getElementById('countersBox').style.display = 'none';
            document.getElementById('finalScore').textContent = convertToSelectedNumerals(state.score);
            document.getElementById('totalQuestions').textContent = convertToSelectedNumerals(state.questions.length);
        }
function restartQuiz() {
    state.currentQuestion = 0;
    state.score = 0;
    state.timeLeft = state.questionTime;
    state.answeredQuestions.fill(false);
    const quizBox = document.querySelector('.quiz-box');
    const scoreBoard = document.getElementById('scoreBoard');
    const buttonsContainer = document.querySelector('.buttons-container');
    const countersBox = document.getElementById('countersBox');
    
    if (quizBox) {
        quizBox.style.display = 'block';
        quizBox.style.visibility = 'visible';
        // ŸÑÿß ŸÜŸÖÿ≥ÿ≠ ŸÖÿ≠ÿ™ŸàŸäÿßÿ™ quizBox ŸÑÿ£ŸÜŸáÿß ÿ™ÿ≠ÿ™ŸàŸä ÿπŸÑŸâ question Ÿà options
    }
    if (scoreBoard) scoreBoard.style.display = 'none';
    if (buttonsContainer) buttonsContainer.style.display = 'flex';
    if (countersBox) countersBox.style.display = 'flex';
    
    const progress = document.getElementById('progress');
    if (progress) progress.style.width = '0%';
    
    document.querySelectorAll('.option').forEach(option => {
        option.classList.remove('correct', 'wrong');
        option.style.pointerEvents = 'auto';
    });
    showQuestion();
}

        function togglePause() {
            state.isPaused = !state.isPaused;
            const btn = document.getElementById('pauseBtn');
            btn.textContent = state.isPaused ? 'ÿßÿ≥ÿ™ÿ¶ŸÜÿßŸÅ' : 'ÿ™ŸàŸÇŸÅ';
            btn.style.background = state.isPaused ? '#28a745' : '#ffc107';
        }
        function toggleSettingsPanel() {
            const panel = document.getElementById('settingsPanel');
            panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
        }
        function toggleConfigPanel() {
            const panel = document.getElementById('configPanel');
            if (panel.style.display === 'block') {
                panel.style.display = 'none';
            } else {
                panel.style.display = 'block';
                document.getElementById('titleInput').value = quizConfig.title;
                document.getElementById('instructionsInput').value = quizConfig.instructions;
            }
        }
        function saveConfig() {
            const newTitle = document.getElementById('titleInput').value;
            const newInstructions = document.getElementById('instructionsInput').value;
            const newFooter = document.getElementById('footerInput').value;
            if (newTitle) {
                quizConfig.title = newTitle;
                document.getElementById('quizTitle').textContent = newTitle;
            }
            if (newInstructions) {
                quizConfig.instructions = newInstructions;
                document.getElementById('instructions').textContent = newInstructions;
            }
            if (newFooter) {
                document.getElementById('quizFooter').textContent = newFooter;
            }
            toggleConfigPanel();
        }
        function convertToSelectedNumerals(num) {
            if (num === undefined || num === null) return state.numeralType === 'eastern' ? "Ÿ†" : "0";
            if (state.numeralType === 'eastern') {
                const easternArabicNumerals = ['Ÿ†', 'Ÿ°', 'Ÿ¢', 'Ÿ£', 'Ÿ§', 'Ÿ•', 'Ÿ¶', 'Ÿß', 'Ÿ®', 'Ÿ©'];
                return num.toString().replace(/\d/g, digit => easternArabicNumerals[digit]);
            }
            return num.toString();
        }
        function convertTextNumerals(text) {
            if (!text || typeof text !== 'string') return text;
            const easternArabicNumerals = ['Ÿ†', 'Ÿ°', 'Ÿ¢', 'Ÿ£', 'Ÿ§', 'Ÿ•', 'Ÿ¶', 'Ÿß', 'Ÿ®', 'Ÿ©'];
            return text.replace(/\d/g, digit => state.numeralType === 'eastern' ? easternArabicNumerals[digit] : digit);
        }
        function changeNumeralType() {
            state.numeralType = document.getElementById('numeralType').value;
            updateQuestionCounter();
            updateScoreCounter();
            updateTimerDisplay();
            showQuestion();
        }
        function changeQuestionTime() {
            const questionTime = parseInt(document.getElementById('questionTime').value);
            if (questionTime >= 5 && questionTime <= 120) {
                state.questionTime = questionTime;
                state.timeLeft = questionTime;
                updateTimerDisplay();
            }
        }
        function updateQuestionCounter() {
            document.getElementById('questionCounter').textContent = 
                `ÿßŸÑÿ≥ÿ§ÿßŸÑ ${convertToSelectedNumerals(state.currentQuestion + 1)} ŸÖŸÜ ${convertToSelectedNumerals(state.questions.length)}`;
        }
        function updateScoreCounter() {
            document.getElementById('scoreCounter').textContent = 
                `ÿßŸÑÿØÿ±ÿ¨ÿßÿ™: ${convertToSelectedNumerals(state.score)} ŸÖŸÜ ${convertToSelectedNumerals(state.questions.length)}`;
        }
        function loadQuestionsFromFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const loadedQuestions = JSON.parse(e.target.result);
                            state.questions = loadedQuestions;
                            init();
                        } catch (error) {
                            alert("ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ŸÖŸÑŸÅ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©. ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜ ÿßŸÑŸÖŸÑŸÅ ÿ®ÿµŸäÿ∫ÿ© JSON ÿµÿ≠Ÿäÿ≠ÿ©.");
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
        function saveQuestionsToFile() {
            if (!state.questions || state.questions.length === 0) {
                alert("ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ£ÿ≥ÿ¶ŸÑÿ© ŸÑÿ≠ŸÅÿ∏Ÿáÿß!");
                return;
            }
            const dataStr = JSON.stringify(state.questions, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', 'quiz_questions.json');
            linkElement.click();
        }
                /**
         * ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ŸÉŸÜÿ≥ÿÆÿ© ÿ∑ÿßŸÑÿ® ŸÑŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÖÿ≠ŸÑŸä
         * ÿ™ÿπÿ™ŸÖÿØ ÿπŸÑŸâ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿπÿ±ÿ∂ ÿßŸÑÿ≠ÿßŸÑŸäÿ© (ŸÜŸàÿπ ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ)
         */
function saveAppForOfflineUse() {
    try {
        const htmlContent = document.documentElement.outerHTML;
        const parser = new DOMParser();
        const doc = parser.parseFromString(htmlContent, 'text/html');
        
        const numeralTypeText = state.numeralType === 'eastern' ? 'ÿ£ÿ±ŸÇÿßŸÖ ŸáŸÜÿØŸäÿ© ÿ¥ÿ±ŸÇ ÿ£Ÿàÿ≥ÿ∑Ÿäÿ©' : 'ÿ£ÿ±ŸÇÿßŸÖ ÿπÿ±ÿ®Ÿäÿ©';
        const titleElement = doc.querySelector('title');
        if (titleElement) {
            titleElement.textContent = `ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿ™ŸÅÿßÿπŸÑŸäÿ© ÿ™ÿπŸÑŸäŸÖŸäÿ© - ŸÜÿ≥ÿÆÿ© ÿßŸÑÿ∑ÿßŸÑÿ® (${numeralTypeText})`;
        }
        
        const selectorsToRemove = [
            '.config-btn',
            '.buttons-container',
            '.settings-panel',
            '.config-panel',
            '#fontControlPanel',
            '#editPanel',
            '#editButton',
            '#loadButton',
            '#saveQuestionsButton',
            '#saveAppButton'
        ];
        selectorsToRemove.forEach(selector => {
            const element = doc.querySelector(selector);
            if (element) element.remove();
        });
        
        const scripts = doc.querySelectorAll('script');
        let lastScript = scripts[scripts.length - 1];
        
        if (lastScript) {
            const currentQuestionsJSON = JSON.stringify(state.questions);
            const studentScriptContent = `
                let quizState = {
                    questions: [],
                    currentQuestion: 0,
                    score: 0,
                    timeLeft: ${state.questionTime},
                    questionTime: ${state.questionTime},
                    timerId: null,
                    isPaused: false,
                    answeredQuestions: [],
                    numeralType: "${state.numeralType}"
                };
                const quizConfig = {
                    title: '${quizConfig.title}',
                    instructions: '${quizConfig.instructions}'
                };
                quizState.questions = ${currentQuestionsJSON};
                quizState.answeredQuestions = new Array(quizState.questions.length).fill(false);
                
                function convertToSelectedNumerals(num) {
                    if (num === undefined || num === null) return quizState.numeralType === 'eastern' ? "Ÿ†" : "0";
                    if (quizState.numeralType === 'eastern') {
                        const easternArabicNumerals = ['Ÿ†', 'Ÿ°', 'Ÿ¢', 'Ÿ£', 'Ÿ§', 'Ÿ•', 'Ÿ¶', 'Ÿß', 'Ÿ®', 'Ÿ©'];
                        return num.toString().replace(/\\d/g, digit => easternArabicNumerals[digit]);
                    }
                    return num.toString();
                }

                function convertTextNumerals(text) {
                    if (!text || typeof text !== 'string') return text;
                    const easternArabicNumerals = ['Ÿ†', 'Ÿ°', 'Ÿ¢', 'Ÿ£', 'Ÿ§', 'Ÿ•', 'Ÿ¶', 'Ÿß', 'Ÿ®', 'Ÿ©'];
                    return text.replace(/\\d/g, digit => quizState.numeralType === 'eastern' ? easternArabicNumerals[digit] : digit);
                }

                function init() {
                    if (quizState.questions.length === 0) {
                        const questionCounter = document.getElementById('questionCounter');
                        const timer = document.getElementById('timer');
                        const scoreCounter = document.getElementById('scoreCounter');
                        if (questionCounter) questionCounter.textContent = \`ÿßŸÑÿ≥ÿ§ÿßŸÑ \${convertToSelectedNumerals(0)} ŸÖŸÜ \${convertToSelectedNumerals(0)}\`;
                        if (timer) timer.textContent = \`ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÖÿ™ÿ®ŸÇŸä: \${convertToSelectedNumerals(quizState.timeLeft)} ÿ´ÿßŸÜŸäÿ©\`;
                        if (scoreCounter) scoreCounter.textContent = \`ÿßŸÑÿØÿ±ÿ¨ÿßÿ™: \${convertToSelectedNumerals(0)} ŸÖŸÜ \${convertToSelectedNumerals(0)}\`;
                        return;
                    }
                    quizState.currentQuestion = 0;
                    quizState.score = 0;
                    quizState.timeLeft = quizState.questionTime;
                    quizState.answeredQuestions = new Array(quizState.questions.length).fill(false);
                    showQuestion();
                }

                function showQuestion() {
                    clearInterval(quizState.timerId);
                    quizState.timeLeft = quizState.questionTime;
                    const quizBox = document.querySelector('.quiz-box');
                    let questionElement = document.getElementById('question');
                    let optionsElement = document.getElementById('options');
                    let readingTextElement = document.getElementById('readingText');
                    
                    // ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ© ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ŸÉŸÜ ŸÖŸàÿ¨ŸàÿØÿ©
                    if (!questionElement) {
                        questionElement = document.createElement('div');
                        questionElement.id = 'question';
                        questionElement.className = 'question';
                        quizBox.appendChild(questionElement);
                    }
                    if (!optionsElement) {
                        optionsElement = document.createElement('div');
                        optionsElement.id = 'options';
                        optionsElement.className = 'options';
                        quizBox.appendChild(optionsElement);
                    }
                    if (!readingTextElement) {
                        readingTextElement = document.createElement('div');
                        readingTextElement.id = 'readingText';
                        readingTextElement.className = 'reading-text';
                        quizBox.appendChild(readingTextElement);
                    }
                    
                    if (quizState.currentQuestion >= quizState.questions.length) {
                        showResult();
                        return;
                    }
                    
                    const questionObj = quizState.questions[quizState.currentQuestion];
                    readingTextElement.innerHTML = '';
                    
                    let readingTextContent = '';
                    let readingImageSrc = null;
                    
                    if (questionObj.reading) {
                        readingTextContent = questionObj.reading.text || '';
                        readingImageSrc = questionObj.reading.image || null;
                    }
                    
                    if (!readingTextContent && questionObj.readingText) {
                        if (typeof questionObj.readingText === "string") {
                            readingTextContent = questionObj.readingText;
                        } else if (typeof questionObj.readingText === "object") {
                            readingTextContent = questionObj.readingText.text || '';
                            readingImageSrc = questionObj.readingText.image || null;
                        }
                    }
                    
                    if (!readingTextContent && questionObj.paragraph) {
                        readingTextContent = questionObj.paragraph;
                    }
                    
                    if (!readingImageSrc && questionObj.paragraphImage) {
                        readingImageSrc = questionObj.paragraphImage;
                    }
                    
                    if (readingTextContent || readingImageSrc) {
                        readingTextElement.style.display = 'block';
                        if (readingTextContent) {
                            const textElement = document.createElement('div');
                            textElement.className = 'reading-text-content';
                            textElement.innerHTML = convertTextNumerals(readingTextContent).replaceAll('//', '<br>');
                            readingTextElement.appendChild(textElement);
                        }
                        
                        if (readingImageSrc) {
                            const imgElement = document.createElement('img');
                            imgElement.src = readingImageSrc;
                            imgElement.className = 'reading-text-image';
                            imgElement.alt = 'ÿµŸàÿ±ÿ© ÿßŸÑŸÜÿµ ÿßŸÑŸÇÿ±ÿßÿ¶Ÿä';
                            readingTextElement.appendChild(imgElement);
                        }
                    } else {
                        readingTextElement.style.display = 'none';
                    }
                    
                    questionElement.innerHTML = '';
                    const questionContent = document.createElement('div');
                    questionContent.className = 'question-content';
                    
                    if (questionObj.question.text) {
                        const textElement = document.createElement('div');
                        textElement.className = 'question-text';
                        textElement.innerHTML = convertTextNumerals(questionObj.question.text).replaceAll('//', '<br>');
                        questionContent.appendChild(textElement);
                    }
                    
                    if (questionObj.question.image) {
                        const imgElement = document.createElement('img');
                        imgElement.src = questionObj.question.image;
                        imgElement.className = 'question-image';
                        questionContent.appendChild(imgElement);
                    }
                    
                    questionElement.appendChild(questionContent);
                    optionsElement.innerHTML = '';
                    
                    if (!questionObj.options || questionObj.options.length === 0) {
                        console.error("ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿÆŸäÿßÿ±ÿßÿ™ ŸÖÿ™ÿßÿ≠ÿ© ŸÑŸáÿ∞ÿß ÿßŸÑÿ≥ÿ§ÿßŸÑ!");
                        return;
                    }
                    
                    const validOptions = [];
                    const optionIndices = [];
                    
                    questionObj.options.forEach((option, index) => {
                        if (!option || (!option.text && !option.image)) return;
                        
                        const optionElement = document.createElement('div');
                        optionElement.className = 'option';
                        optionElement.dataset.originalIndex = index;
                        
                        const optionContent = document.createElement('div');
                        optionContent.className = 'option-content';
                        
                        if (option.image) {
                            const img = document.createElement('img');
                            img.src = option.image;
                            img.className = 'option-image';
                            optionContent.appendChild(img);
                        }
                        
                        if (option.text) {
                            const text = document.createElement('span');
                            text.className = 'option-text';
                            text.innerHTML = convertTextNumerals(option.text).replaceAll('//', '<br>');
                            optionContent.appendChild(text);
                        }
                        
                        optionElement.appendChild(optionContent);
                        validOptions.push(optionElement);
                        optionIndices.push(index);
                    });
                    
                    optionsElement.classList.remove('options-row', 'options-two', 'options-three');
                    if (validOptions.length <= 3) {
                        optionsElement.classList.add('options-row');
                        if (validOptions.length === 2) {
                            optionsElement.classList.add('options-two');
                        } else if (validOptions.length === 3) {
                            optionsElement.classList.add('options-three');
                        }
                    }
                    
                    validOptions.forEach((optionElement, i) => {
                        const originalIndex = optionIndices[i];
                        if (quizState.answeredQuestions[quizState.currentQuestion]) {
                            optionElement.style.pointerEvents = 'none';
                            if (originalIndex === questionObj.correct) {
                                optionElement.classList.add('correct');
                            }
                        }
                        optionElement.onclick = () => checkAnswer(originalIndex);
                        optionsElement.appendChild(optionElement);
                    });
                    
                    const prevBtn = document.getElementById('prevBtn');
                    const nextBtn = document.getElementById('nextBtn');
                    if (prevBtn) prevBtn.disabled = quizState.currentQuestion === 0;
                    if (nextBtn) nextBtn.disabled = false;
                    
                    const progress = document.getElementById('progress');
                    if (progress) progress.style.width = \`\${(quizState.currentQuestion / quizState.questions.length) * 100}%\`;
                    
                    updateQuestionCounter();
                    updateScoreCounter();
                    startTimer();
                }

                function startTimer() {
                    quizState.timerId = setInterval(() => {
                        if (!quizState.isPaused) {
                            quizState.timeLeft--;
                            updateTimerDisplay();
                            if (quizState.timeLeft <= 0) {
                                clearInterval(quizState.timerId);
                                nextQuestion();
                            }
                        }
                    }, 1000);
                }

                function updateTimerDisplay() {
                    const timer = document.getElementById('timer');
                    if (timer) timer.textContent = \`ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÖÿ™ÿ®ŸÇŸä: \${convertToSelectedNumerals(quizState.timeLeft)} ÿ´ÿßŸÜŸäÿ©\`;
                }

                function checkAnswer(selectedIndex) {
                    const options = document.querySelectorAll('.option');
                    const correctIndex = quizState.questions[quizState.currentQuestion].correct;
                    
                    if (quizState.answeredQuestions[quizState.currentQuestion]) return;
                    
                    options.forEach(option => option.style.pointerEvents = 'none');
                    if (options[correctIndex]) options[correctIndex].classList.add('correct');
                    
                    if (selectedIndex === correctIndex) {
                        quizState.score++;
                        quizState.answeredQuestions[quizState.currentQuestion] = true;
                        updateScoreCounter();
                    } else if (options[selectedIndex]) {
                        options[selectedIndex].classList.add('wrong');
                    }
                    
                    if (quizState.currentQuestion < quizState.questions.length - 1) {
                        setTimeout(nextQuestion, 1500);
                    } else {
                        setTimeout(showResult, 1500);
                    }
                }

                function nextQuestion() {
                    if (quizState.currentQuestion >= quizState.questions.length - 1) {
                        showResult();
                        return;
                    }
                    quizState.currentQuestion++;
                    showQuestion();
                }

                function previousQuestion() {
                    if (quizState.currentQuestion > 0) {
                        quizState.currentQuestion--;
                        showQuestion();
                    }
                    const nextBtn = document.getElementById('nextBtn');
                    if (nextBtn) nextBtn.disabled = false;
                }

                function showResult() {
                    clearInterval(quizState.timerId);
                    const quizBox = document.querySelector('.quiz-box');
                    const scoreBoard = document.getElementById('scoreBoard');
                    const readingText = document.getElementById('readingText');
                    const countersBox = document.getElementById('countersBox');
                    const buttonsContainer = document.querySelector('.buttons-container');
                    
                    if (quizBox) {
                        quizBox.style.display = 'none';
                        quizBox.style.visibility = 'hidden';
                    }
                    if (scoreBoard) scoreBoard.style.display = 'block';
                    if (buttonsContainer) buttonsContainer.style.display = 'none';
                    if (readingText) readingText.style.display = 'none';
                    if (countersBox) countersBox.style.display = 'none';
                    
                    const finalScore = document.getElementById('finalScore');
                    const totalQuestions = document.getElementById('totalQuestions');
                    
                    if (finalScore) finalScore.textContent = convertToSelectedNumerals(quizState.score);
                    if (totalQuestions) totalQuestions.textContent = convertToSelectedNumerals(quizState.questions.length);
                }

                function restartQuiz() {
                    quizState.currentQuestion = 0;
                    quizState.score = 0;
                    quizState.timeLeft = quizState.questionTime;
                    quizState.answeredQuestions.fill(false);
                    const quizBox = document.querySelector('.quiz-box');
                    const scoreBoard = document.getElementById('scoreBoard');
                    const buttonsContainer = document.querySelector('.buttons-container');
                    const countersBox = document.getElementById('countersBox');
                    
                    if (quizBox) {
                        quizBox.style.display = 'block';
                        quizBox.style.visibility = 'visible';
                        // ŸÑÿß ŸÜŸÖÿ≥ÿ≠ ŸÖÿ≠ÿ™ŸàŸäÿßÿ™ quizBox ŸÑÿ£ŸÜŸáÿß ÿ™ÿ≠ÿ™ŸàŸä ÿπŸÑŸâ question Ÿà options
                    }
                    if (scoreBoard) scoreBoard.style.display = 'none';
                    if (buttonsContainer) buttonsContainer.style.display = 'flex';
                    if (countersBox) countersBox.style.display = 'flex';
                    
                    const progress = document.getElementById('progress');
                    if (progress) progress.style.width = '0%';
                    
                    document.querySelectorAll('.option').forEach(option => {
                        option.classList.remove('correct', 'wrong');
                        option.style.pointerEvents = 'auto';
                    });
                    showQuestion();
                }

                function togglePause() {
                    quizState.isPaused = !quizState.isPaused;
                    const btn = document.getElementById('pauseBtn');
                    if (btn) {
                        btn.textContent = quizState.isPaused ? 'ÿßÿ≥ÿ™ÿ¶ŸÜÿßŸÅ' : 'ÿ™ŸàŸÇŸÅ';
                        btn.style.background = quizState.isPaused ? '#28a745' : '#ffc107';
                    }
                }

                function updateQuestionCounter() {
                    const questionCounter = document.getElementById('questionCounter');
                    if (questionCounter) {
                        questionCounter.textContent = 
                            \`ÿßŸÑÿ≥ÿ§ÿßŸÑ \${convertToSelectedNumerals(quizState.currentQuestion + 1)} ŸÖŸÜ \${convertToSelectedNumerals(quizState.questions.length)}\`;
                    }
                }

                function updateScoreCounter() {
                    const scoreCounter = document.getElementById('scoreCounter');
                    if (scoreCounter) {
                        scoreCounter.textContent = 
                            \`ÿßŸÑÿØÿ±ÿ¨ÿßÿ™: \${convertToSelectedNumerals(quizState.score)} ŸÖŸÜ \${convertToSelectedNumerals(quizState.questions.length)}\`;
                    }
                }

                window.onload = function() {
                    const readingText = document.getElementById('readingText');
                    if (readingText) readingText.style.display = 'none';
                    const questionCounter = document.getElementById('questionCounter');
                    const timer = document.getElementById('timer');
                    const scoreCounter = document.getElementById('scoreCounter');
                    if (questionCounter) questionCounter.innerHTML = \`ÿßŸÑÿ≥ÿ§ÿßŸÑ \${convertToSelectedNumerals(1)} ŸÖŸÜ \${convertToSelectedNumerals(quizState.questions.length)}\`;
                    if (timer) timer.innerHTML = \`ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÖÿ™ÿ®ŸÇŸä: \${convertToSelectedNumerals(quizState.timeLeft)} ÿ´ÿßŸÜŸäÿ©\`;
                    if (scoreCounter) scoreCounter.innerHTML = \`ÿßŸÑÿØÿ±ÿ¨ÿßÿ™: \${convertToSelectedNumerals(0)} ŸÖŸÜ \${convertToSelectedNumerals(quizState.questions.length)}\`;
                    const prevBtn = document.getElementById('prevBtn');
                    const nextBtn = document.getElementById('nextBtn');
                    const pauseBtn = document.getElementById('pauseBtn');
                    const retryBtn = document.getElementById('retryBtn');
                    if (prevBtn) prevBtn.onclick = previousQuestion;
                    if (nextBtn) nextBtn.onclick = nextQuestion;
                    if (pauseBtn) pauseBtn.onclick = togglePause;
                    if (retryBtn) retryBtn.onclick = restartQuiz;
                    init();
                };
            `;
            const studentScript = doc.createElement('script');
            studentScript.textContent = studentScriptContent;
            lastScript.parentNode.insertBefore(studentScript, lastScript.nextSibling);
            
            lastScript.remove();
        }
        
        const requiredElements = [
            { id: 'quizBox', class: 'quiz-box', tag: 'div', style: 'display: none; visibility: hidden; height: 0; width: 0; padding: 0; margin: 0;' },
            { id: 'scoreBoard', class: 'scoreboard', tag: 'div', style: 'display: none;' },
            { id: 'countersBox', class: 'counters-box', tag: 'div', style: 'display: flex;' },
            { id: 'readingText', class: 'reading-text', tag: 'div', style: 'display: none;' },
            { id: 'question', class: 'question', tag: 'div' },
            { id: 'options', class: 'options', tag: 'div' },
            { id: 'questionCounter', class: 'counter', tag: 'div' },
            { id: 'timer', class: 'timer', tag: 'div' },
            { id: 'scoreCounter', class: 'score-counter', tag: 'div' },
            { id: 'progress', class: 'progress', tag: 'div' },
            { id: 'prevBtn', class: 'nav-btn', tag: 'button', text: 'ÿßŸÑÿ≥ÿßÿ®ŸÇ', style: 'margin: 5px;' },
            { id: 'nextBtn', class: 'nav-btn', tag: 'button', text: 'ÿßŸÑÿ™ÿßŸÑŸä', style: 'margin: 5px;' },
            { id: 'pauseBtn', class: 'nav-btn', tag: 'button', text: 'ÿ™ŸàŸÇŸÅ', style: 'margin: 5px; background: #ffc107;' },
            { id: 'finalScore', class: 'final-score', tag: 'span' },
            { id: 'totalQuestions', class: 'total-questions', tag: 'span' }
        ];
        requiredElements.forEach(({ id, class: className, tag, text, style }) => {
            let element = doc.querySelector(`#${id}`);
            if (!element) {
                element = doc.createElement(tag);
                element.id = id;
                element.className = className;
                if (text) element.textContent = text;
                if (style) element.style.cssText = style;
                // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑŸÅÿ±ÿπŸäÿ© (question, options, readingText) ÿØÿßÿÆŸÑ quizBox
                if (id === 'quizBox') {
                    const readingText = doc.createElement('div');
                    readingText.id = 'readingText';
                    readingText.className = 'reading-text';
                    readingText.style.display = 'none';
                    element.appendChild(readingText);
                    
                    const question = doc.createElement('div');
                    question.id = 'question';
                    question.className = 'question';
                    element.appendChild(question);
                    
                    const options = doc.createElement('div');
                    options.id = 'options';
                    options.className = 'options';
                    element.appendChild(options);
                }
                doc.body.appendChild(element);
            } else if (style) {
                element.style.cssText = style;
            }
        });
        
        const modifiedHTML = '<!DOCTYPE html>\n' + doc.documentElement.outerHTML;
        const blob = new Blob([modifiedHTML], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const numeralTypeSuffix = state.numeralType === 'eastern' ? 'eastern' : 'arabic';
        const a = document.createElement('a');
        a.href = url;
        a.download = `quiz_app_student_${numeralTypeSuffix}.html`;
        a.click();
        setTimeout(() => URL.revokeObjectURL(url), 100);
    } catch (error) {
        console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ:', error);
        alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
    }
}

        // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ•ÿØÿßÿ±Ÿäÿ© ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©
        window.onload = function () {
            // ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÜÿµ ÿßŸÑŸÇÿ±ÿßÿ¶Ÿä ÿπŸÜÿØ ŸÅÿ™ÿ≠ ÿßŸÑÿµŸÅÿ≠ÿ©
            const readingText = document.getElementById('readingText');
            if (readingText) {
                readingText.style.display = 'none';
            }

            // ÿ™ÿπÿØŸäŸÑ ÿ≤ÿ± ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑŸÖŸàÿ¨ŸàÿØ
            const loadButton = document.getElementById('loadButton');
            if (loadButton) {
                loadButton.onclick = loadQuestionsFromFile;
            }

            // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ•ÿ∂ÿßŸÅŸäÿ© ÿ•ŸÑŸâ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ±
            const buttonsContainer = document.querySelector('.buttons-container');

            // ÿ≤ÿ± ÿ≠ŸÅÿ∏ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©
            const saveQuestionsButton = document.createElement('button');
            saveQuestionsButton.id = 'saveQuestionsButton';
            saveQuestionsButton.textContent = 'ÿ≠ŸÅÿ∏ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©';
            saveQuestionsButton.className = 'action-btn';
            saveQuestionsButton.onclick = saveQuestionsToFile;
            buttonsContainer.appendChild(saveQuestionsButton);

            // ÿ≤ÿ± ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ŸÑŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÖÿ≠ŸÑŸä
            const saveAppButton = document.createElement('button');
            saveAppButton.id = 'saveAppButton';
            saveAppButton.textContent = 'ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ';
            saveAppButton.className = 'action-btn';
            saveAppButton.style.backgroundColor = '#6c757d';
            saveAppButton.onclick = saveAppForOfflineUse;
            buttonsContainer.appendChild(saveAppButton);

            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ£ŸàŸÑŸäÿ©
            document.getElementById('questionCounter').innerHTML = `ÿßŸÑÿ≥ÿ§ÿßŸÑ ${convertToSelectedNumerals(0)} ŸÖŸÜ ${convertToSelectedNumerals(0)}`;
            document.getElementById('timer').innerHTML = `ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÖÿ™ÿ®ŸÇŸä: ${convertToSelectedNumerals(state.timeLeft)} ÿ´ÿßŸÜŸäÿ©`;
            document.getElementById('scoreCounter').innerHTML = `ÿßŸÑÿØÿ±ÿ¨ÿßÿ™: ${convertToSelectedNumerals(0)} ŸÖŸÜ ${convertToSelectedNumerals(0)}`;

            // ÿ™ÿ≠ÿØŸäÿ´ ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÉŸàŸäÿ≤
            document.getElementById('quizTitle').textContent = quizConfig.title;

            // ÿ™ÿ≠ÿØŸäÿ´ ŸÇŸäŸÖ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
            document.getElementById('numeralType').value = state.numeralType;
            document.getElementById('questionTime').value = state.questionTime;

            // ÿ®ÿØÿ° ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±
            init();
        };
        
        function cleanEasternNumerals() {
            if (!state.questions || !Array.isArray(state.questions)) return;
            const easternArabic = ['Ÿ†', 'Ÿ°', 'Ÿ¢', 'Ÿ£', 'Ÿ§', 'Ÿ•', 'Ÿ¶', 'Ÿß', 'Ÿ®', 'Ÿ©'];
            function convertEasternToArabic(text) {
                if (!text || typeof text !== 'string') return text;
                return text.replace(/[Ÿ†-Ÿ©]/g, d => easternArabic.indexOf(d));
            }
            state.questions.forEach(q => {
                if (q.question && q.question.text) q.question.text = convertEasternToArabic(q.question.text);
                if (q.reading && q.reading.text) q.reading.text = convertEasternToArabic(q.reading.text);
                if (q.readingText && typeof q.readingText === "object" && q.readingText.text) q.readingText.text = convertEasternToArabic(q.readingText.text);
                if (q.options && Array.isArray(q.options)) q.options.forEach(opt => { if (opt.text) opt.text = convertEasternToArabic(opt.text); });
            });
            alert("‚úÖ ÿ™ŸÖ ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ ÿßŸÑŸáŸÜÿØŸäÿ© ÿ®ŸÜÿ¨ÿßÿ≠!");
            showQuestion();
        }

// ÿ™ŸÅÿπŸäŸÑ/ÿ•ŸÑÿ∫ÿßÿ° Ÿàÿ∂ÿπ ÿßŸÑÿ™ÿ≠ÿ±Ÿäÿ±
function toggleEditMode() {
    const editPanel = document.getElementById('editPanel');
    const quizBox = document.querySelector('.quiz-box');
    const countersBox = document.getElementById('countersBox');
    const readingText = document.getElementById('readingText');
    
    if (editPanel.style.display === 'block') {
        editPanel.style.display = 'none';
        quizBox.style.display = 'block';
        countersBox.style.display = 'flex';
        readingText.style.display = state.questions[state.currentQuestion] && 
            (state.questions[state.currentQuestion].reading || state.questions[state.currentQuestion].readingText || state.questions[state.currentQuestion].paragraph) 
            ? 'block' : 'none';
        startTimer();
    } else {
        if (state.questions.length === 0) {
            alert('Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿ£ŸàŸÑÿßŸã!');
            return;
        }
        editPanel.style.display = 'block';
        quizBox.style.display = 'none';
        countersBox.style.display = 'none';
        readingText.style.display = 'none';
        clearInterval(state.timerId);
        populateEditForm();
    }
}

// ŸÖŸÑÿ° ŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑÿ™ÿ≠ÿ±Ÿäÿ± ÿ®ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ≠ÿßŸÑŸä
function populateEditForm() {
    const questionObj = state.questions[state.currentQuestion];
    if (!questionObj) return;

    // ÿßŸÑŸÜÿµ ÿßŸÑŸÇÿ±ÿßÿ¶Ÿä
    let readingText = '';
    let readingImage = null;
    if (questionObj.reading) {
        readingText = questionObj.reading.text || '';
        readingImage = questionObj.reading.image || null;
    } else if (questionObj.readingText) {
        readingText = typeof questionObj.readingText === 'string' ? questionObj.readingText : questionObj.readingText.text || '';
        readingImage = typeof questionObj.readingText === 'object' ? questionObj.readingText.image || null : null;
    } else if (questionObj.paragraph) {
        readingText = questionObj.paragraph || '';
        readingImage = questionObj.paragraphImage || null;
    }
    document.getElementById('editReadingText').value = readingText;
    document.getElementById('readingImagePreview').src = readingImage || '';
    document.getElementById('readingImagePreview').style.display = readingImage ? 'block' : 'none';

    // ÿßŸÑÿ≥ÿ§ÿßŸÑ
    document.getElementById('editQuestionText').value = questionObj.question.text || '';
    document.getElementById('questionImagePreview').src = questionObj.question.image || '';
    document.getElementById('questionImagePreview').style.display = questionObj.question.image ? 'block' : 'none';

    // ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™
    for (let i = 0; i < 4; i++) {
        const option = questionObj.options[i] || { text: '', image: null };
        document.getElementById(`editOption${i + 1}`).value = option.text || '';
        document.getElementById(`optionImagePreview${i + 1}`).src = option.image || '';
        document.getElementById(`optionImagePreview${i + 1}`).style.display = option.image ? 'block' : 'none';
        document.getElementById(`correct${i + 1}`).checked = (i === questionObj.correct);
    }
}

// ŸÖÿπÿßŸÑÿ¨ÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸàÿ±
function handleImageUpload(input, previewId, callback) {
    const file = input.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById(previewId).src = e.target.result;
            document.getElementById(previewId).style.display = 'block';
            callback(e.target.result);
        };
        reader.readAsDataURL(file);
    }
}

// ÿ±ÿ®ÿ∑ ÿ≠ŸÇŸàŸÑ ÿßŸÑÿµŸàÿ±
document.getElementById('editReadingImage').addEventListener('change', function() {
    handleImageUpload(this, 'readingImagePreview', function(base64) {
        const questionObj = state.questions[state.currentQuestion];
        if (questionObj.reading) {
            questionObj.reading.image = base64;
        } else if (questionObj.readingText && typeof questionObj.readingText === 'object') {
            questionObj.readingText.image = base64;
        } else {
            questionObj.paragraphImage = base64;
        }
    });
});

document.getElementById('editQuestionImage').addEventListener('change', function() {
    handleImageUpload(this, 'questionImagePreview', function(base64) {
        state.questions[state.currentQuestion].question.image = base64;
    });
});

for (let i = 1; i <= 4; i++) {
    document.getElementById(`editOptionImage${i}`).addEventListener('change', function() {
        handleImageUpload(this, `optionImagePreview${i}`, function(base64) {
            const questionObj = state.questions[state.currentQuestion];
            if (!questionObj.options[i - 1]) {
                questionObj.options[i - 1] = { text: '', image: null };
            }
            questionObj.options[i - 1].image = base64;
        });
    });

    document.getElementById(`correct${i}`).addEventListener('change', function() {
        if (this.checked) {
            for (let j = 1; j <= 4; j++) {
                document.getElementById(`correct${j}`).checked = (j === i);
            }
            state.questions[state.currentQuestion].correct = i - 1;
        }
    });
}

// ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™
function saveEdit() {
    const questionText = document.getElementById('editQuestionText').value.trim();
    const options = [
        document.getElementById('editOption1').value.trim(),
        document.getElementById('editOption2').value.trim(),
        document.getElementById('editOption3').value.trim(),
        document.getElementById('editOption4').value.trim()
    ];
    const nonEmptyOptions = options.filter(opt => opt !== '').length;
    const correctCheckedIndex = Array.from({length: 4}, (_, i) => 
        document.getElementById(`correct${i + 1}`).checked ? i : -1).filter(i => i >= 0)[0];

    // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
    if (!questionText) {
        alert('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ŸÜÿµ ÿßŸÑÿ≥ÿ§ÿßŸÑ!');
        return;
    }
    if (nonEmptyOptions < 0) {
        alert('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ ÿÆŸäÿßÿ±ŸäŸÜ ÿ∫Ÿäÿ± ŸÅÿßÿ±ÿ∫ŸäŸÜ!');
        return;
    }
    if (correctCheckedIndex === undefined || options[correctCheckedIndex] === '') {
        alert('Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ≠ÿØŸäÿØ ÿ•ÿ¨ÿßÿ®ÿ© ÿµÿ≠Ÿäÿ≠ÿ© Ÿàÿßÿ≠ÿØÿ©ÿå Ÿàÿ™ÿ£ŸÉÿØ ÿ£ŸÜ ÿßŸÑÿÆŸäÿßÿ± ÿßŸÑŸÖÿ≠ÿØÿØ ÿ∫Ÿäÿ± ŸÅÿßÿ±ÿ∫!');
        return;
    }

    const questionObj = state.questions[state.currentQuestion];
    const readingText = document.getElementById('editReadingText').value.trim();

    // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÜÿµ ÿßŸÑŸÇÿ±ÿßÿ¶Ÿä
    if (questionObj.reading) {
        questionObj.reading.text = readingText;
    } else if (questionObj.readingText) {
        if (typeof questionObj.readingText === 'string') {
            questionObj.readingText = readingText;
        } else {
            questionObj.readingText.text = readingText;
        }
    } else {
        questionObj.paragraph = readingText;
    }

    // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≥ÿ§ÿßŸÑ
    questionObj.question.text = questionText;

    // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™
    for (let i = 0; i < 4; i++) {
        if (!questionObj.options[i]) {
            questionObj.options[i] = { text: '', image: null };
        }
        questionObj.options[i].text = options[i] || '';
    }
    questionObj.correct = correctCheckedIndex;

    // ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨ Ÿàÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿπÿ±ÿ∂
    document.getElementById('editPanel').style.display = 'none';
    document.querySelector('.quiz-box').style.display = 'block';
    document.getElementById('countersBox').style.display = 'flex';
    document.getElementById('readingText').style.display = readingText || questionObj.paragraphImage ? 'block' : 'none';
    showQuestion();
}

// ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ™ÿ≠ÿ±Ÿäÿ±
function cancelEdit() {
    document.getElementById('editPanel').style.display = 'none';
    document.querySelector('.quiz-box').style.display = 'block';
    document.getElementById('countersBox').style.display = 'flex';
    document.getElementById('readingText').style.display = state.questions[state.currentQuestion] && 
        (state.questions[state.currentQuestion].reading || state.questions[state.currentQuestion].readingText || state.questions[state.currentQuestion].paragraph) 
        ? 'block' : 'none';
    showQuestion();
}

// ÿ•ÿ∂ÿßŸÅÿ© ÿ≥ÿ§ÿßŸÑ ÿ¨ÿØŸäÿØ
function addNewQuestion() {
    const newQuestion = {
        reading: { text: '', image: null },
        question: { text: '', image: null },
        options: [
            { text: '', image: null },
            { text: '', image: null },
            { text: '', image: null },
            { text: '', image: null }
        ],
        correct: 0
    };
    state.questions.push(newQuestion);
    state.currentQuestion = state.questions.length - 1;
    state.answeredQuestions.push(false);
    document.getElementById('editPanel').style.display = 'none';
    document.querySelector('.quiz-box').style.display = 'block';
    document.getElementById('countersBox').style.display = 'flex';
    showQuestion();
}

// ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ≠ÿßŸÑŸä
function deleteCurrentQuestion() {
    if (state.questions.length <= 1) {
        alert('ŸÑÿß ŸäŸÖŸÉŸÜ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑŸàÿ≠ŸäÿØ!');
        return;
    }
    if (confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ≠ÿßŸÑŸäÿü')) {
        state.questions.splice(state.currentQuestion, 1);
        state.answeredQuestions.splice(state.currentQuestion, 1);
        if (state.currentQuestion >= state.questions.length) {
            state.currentQuestion = state.questions.length - 1;
        }
        document.getElementById('editPanel').style.display = 'none';
        document.querySelector('.quiz-box').style.display = 'block';
        document.getElementById('countersBox').style.display = 'flex';
        document.getElementById('readingText').style.display = state.questions[state.currentQuestion] && 
            (state.questions[state.currentQuestion].reading || state.questions[state.currentQuestion].readingText || state.questions[state.currentQuestion].paragraph) 
            ? 'block' : 'none';
        showQuestion();
    }
}
    </script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-W33PZW3VJV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-W33PZW3VJV');
</script>
    
    <footer id="quizFooter">
        ÿ•ÿπÿØÿßÿØ Ÿàÿ™ÿµŸÖŸäŸÖ / ŸÖŸÑÿ™ŸÇŸâ ŸÖÿπŸÑŸÖŸä ŸàŸÖÿπŸÑŸÖÿßÿ™ ÿßŸÑŸÖŸàÿßÿØ ÿßŸÑÿ£ÿÆÿ±Ÿâ ŸÄ ÿßŸÑŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ÿßŸÑÿ≥ÿπŸàÿØŸäÿ©
    </footer>
    </body>
</html>
